<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>闭包 | 周非凡个人博客</title>
    <meta name="description" content="Vue 驱动的静态网站生成器">
    
    
    <link rel="preload" href="/assets/css/0.styles.d01e3fed.css" as="style"><link rel="preload" href="/assets/js/app.c9da9db2.js" as="script"><link rel="preload" href="/assets/js/2.febc0262.js" as="script"><link rel="preload" href="/assets/js/19.e58abf47.js" as="script"><link rel="prefetch" href="/assets/js/10.0253064e.js"><link rel="prefetch" href="/assets/js/11.175002a3.js"><link rel="prefetch" href="/assets/js/12.c9c2623b.js"><link rel="prefetch" href="/assets/js/13.a252b052.js"><link rel="prefetch" href="/assets/js/14.6a53dc1e.js"><link rel="prefetch" href="/assets/js/15.84088994.js"><link rel="prefetch" href="/assets/js/16.09fbb166.js"><link rel="prefetch" href="/assets/js/17.38b70eaf.js"><link rel="prefetch" href="/assets/js/18.24a31878.js"><link rel="prefetch" href="/assets/js/20.a4e1f7ec.js"><link rel="prefetch" href="/assets/js/21.520b96e8.js"><link rel="prefetch" href="/assets/js/22.8455ead8.js"><link rel="prefetch" href="/assets/js/23.012b6e4c.js"><link rel="prefetch" href="/assets/js/24.90bca786.js"><link rel="prefetch" href="/assets/js/25.0b9867c9.js"><link rel="prefetch" href="/assets/js/26.5835b50d.js"><link rel="prefetch" href="/assets/js/27.90bf64b9.js"><link rel="prefetch" href="/assets/js/28.8b2856a2.js"><link rel="prefetch" href="/assets/js/29.4f0f0797.js"><link rel="prefetch" href="/assets/js/3.b8e8b8dc.js"><link rel="prefetch" href="/assets/js/30.ec214258.js"><link rel="prefetch" href="/assets/js/31.19d008c9.js"><link rel="prefetch" href="/assets/js/32.e2e7fb69.js"><link rel="prefetch" href="/assets/js/33.e7250e7c.js"><link rel="prefetch" href="/assets/js/34.6af80751.js"><link rel="prefetch" href="/assets/js/35.8c6fd912.js"><link rel="prefetch" href="/assets/js/36.abacb260.js"><link rel="prefetch" href="/assets/js/37.872fafd6.js"><link rel="prefetch" href="/assets/js/38.c11a6237.js"><link rel="prefetch" href="/assets/js/39.0251e2ab.js"><link rel="prefetch" href="/assets/js/4.a97bd63a.js"><link rel="prefetch" href="/assets/js/40.490030c9.js"><link rel="prefetch" href="/assets/js/41.ae009df1.js"><link rel="prefetch" href="/assets/js/42.733a49d6.js"><link rel="prefetch" href="/assets/js/43.6b0719ec.js"><link rel="prefetch" href="/assets/js/44.8abd3659.js"><link rel="prefetch" href="/assets/js/45.7e9da5d6.js"><link rel="prefetch" href="/assets/js/46.69831b02.js"><link rel="prefetch" href="/assets/js/47.0187e2c6.js"><link rel="prefetch" href="/assets/js/48.d573af72.js"><link rel="prefetch" href="/assets/js/49.c0de9630.js"><link rel="prefetch" href="/assets/js/5.9f3cace6.js"><link rel="prefetch" href="/assets/js/50.dd93629a.js"><link rel="prefetch" href="/assets/js/51.0de94388.js"><link rel="prefetch" href="/assets/js/52.f40156a5.js"><link rel="prefetch" href="/assets/js/53.cd0087a3.js"><link rel="prefetch" href="/assets/js/54.dc27779e.js"><link rel="prefetch" href="/assets/js/55.e83361b5.js"><link rel="prefetch" href="/assets/js/56.e98fbba1.js"><link rel="prefetch" href="/assets/js/57.29f5154b.js"><link rel="prefetch" href="/assets/js/58.2a266b80.js"><link rel="prefetch" href="/assets/js/59.a0a6d426.js"><link rel="prefetch" href="/assets/js/6.ea94c1bd.js"><link rel="prefetch" href="/assets/js/60.431c1ff3.js"><link rel="prefetch" href="/assets/js/61.f3c25606.js"><link rel="prefetch" href="/assets/js/62.df795bbf.js"><link rel="prefetch" href="/assets/js/7.954bbdf7.js"><link rel="prefetch" href="/assets/js/8.5ac09073.js"><link rel="prefetch" href="/assets/js/9.1c3b9112.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d01e3fed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/css/1.html" class="sidebar-link">css 常用知识点</a></li><li><a href="/doc/css/2.html" class="sidebar-link">清除浮动</a></li><li><a href="/doc/css/3.html" class="sidebar-link">三大经典问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/html/1.html" class="sidebar-link">浏览器解析流程</a></li><li><a href="/doc/html/2.html" class="sidebar-link">viewport原理</a></li><li><a href="/doc/html/3.html" class="sidebar-link">meta标签</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/js/1-1.html" class="sidebar-link">堆栈调用（上篇）</a></li><li><a href="/doc/js/1-2.html" class="sidebar-link">堆栈调用（下篇）</a></li><li><a href="/doc/js/2.html" class="active sidebar-link">作用域与闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/2.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/doc/js/2.html#执行环境与作用域" class="sidebar-link">执行环境与作用域</a></li></ul></li><li><a href="/doc/js/3.html" class="sidebar-link">this绑定解析</a></li><li><a href="/doc/js/4-1.html" class="sidebar-link">call、apply原理与使用场景</a></li><li><a href="/doc/js/4-2.html" class="sidebar-link">bind 的原理与使用场景</a></li><li><a href="/doc/js/5-1.html" class="sidebar-link">浅拷贝概念以及实现原理</a></li><li><a href="/doc/js/5-2.html" class="sidebar-link">深拷贝概念以及实现原理</a></li><li><a href="/doc/js/6-1.html" class="sidebar-link">原型与继承之基本概念</a></li><li><a href="/doc/js/6-2.html" class="sidebar-link">原型与继承之（6种继承方案）</a></li><li><a href="/doc/js/7.html" class="sidebar-link">事件机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具函数 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/utils/1.html" class="sidebar-link">常见的JS方法</a></li><li><a href="/doc/utils/2.html" class="sidebar-link">常见的正则表达式</a></li><li><a href="/doc/utils/3.html" class="sidebar-link">常用的时间处理方法</a></li><li><a href="/doc/utils/4.html" class="sidebar-link">常用的金额处理方法</a></li><li><a href="/doc/utils/5.html" class="sidebar-link">继承和原型链demo</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/http/1.html" class="sidebar-link">常见的14种响应状态码</a></li><li><a href="/doc/http/2.html" class="sidebar-link">Http首部字段</a></li><li><a href="/doc/http/3.html" class="sidebar-link">Https介绍</a></li><li><a href="/doc/http/4.html" class="sidebar-link">Web的攻击技术</a></li><li><a href="/doc/http/5.html" class="sidebar-link">Http 发展历史</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/vue/1.html" class="sidebar-link">Vue 双向绑定的原理</a></li><li><a href="/doc/vue/2.html" class="sidebar-link">Vue 踩坑总结</a></li><li><a href="/doc/vue/3.html" class="sidebar-link">Vue 生命周期详解</a></li><li><a href="/doc/vue/4.html" class="sidebar-link">Vuex 基本用法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/node/1.html" class="sidebar-link">用node撸一个前端自动化发布工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/project/1.html" class="sidebar-link">H5项目总结</a></li><li><a href="/doc/project/2.html" class="sidebar-link">首页优化项目总结</a></li><li><a href="/doc/project/3.html" class="sidebar-link">vue 输入限制</a></li><li><a href="/doc/project/4.html" class="sidebar-link">搜车库项目总结</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="闭包"><a href="#闭包" aria-hidden="true" class="header-anchor">#</a> 闭包</h2> <h3 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <p>闭包是指有权访问另外一个函数作用域中的变量的函数<br>
关键在于下面两点：</p> <ul><li>是一个函数</li> <li>能访问另外一个函数作用域中的变量</li></ul> <h3 id="特性"><a href="#特性" aria-hidden="true" class="header-anchor">#</a> 特性</h3> <p><strong>1、闭包可以访问当前函数以外的变量</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getOuter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token string">'815'</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//访问外部的date</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">'今天是：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;今天是：815&quot;</span>
<span class="token punctuation">}</span>
<span class="token function">getOuter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>2、即使外部函数已经返回，闭包仍能访问外部函数定义的变量</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getOuter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token string">'815'</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//访问外部的date</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> getDate<span class="token punctuation">;</span>     <span class="token comment">//外部函数返回</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token function">getOuter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">today</span><span class="token punctuation">(</span><span class="token string">'今天是：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&quot;今天是：815&quot;</span>
<span class="token function">today</span><span class="token punctuation">(</span><span class="token string">'明天不是：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//&quot;明天不是：815&quot;</span>
</code></pre></div><p><strong>3、闭包可以更新外部变量的值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    count <span class="token operator">=</span> val<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> getCount<span class="token punctuation">;</span>     <span class="token comment">//外部函数返回</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token function">updateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token number">815</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//815</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token number">816</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//816</span>
</code></pre></div><h2 id="执行环境与作用域"><a href="#执行环境与作用域" aria-hidden="true" class="header-anchor">#</a> 执行环境与作用域</h2> <h3 id="概念-2"><a href="#概念-2" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <p><strong>作用域</strong>为可访问变量，对象，函数的集合
<strong>执行环境</strong> 定义了变量或函数有权访问的其它数据，决定了他们各自的行为。每个执行环境都有一个与之关联的<strong>变量对象</strong>，环境中定义的所有变量和函数都保存在这个<strong>对象</strong>中。</p> <h3 id="作用域链"><a href="#作用域链" aria-hidden="true" class="header-anchor">#</a> 作用域链</h3> <p>作用域链是由当前作用域与上层一系列父级作用域组成，作用域的头部永远是当前作用域，尾部永远是全局作用域。作用域链保证了当前上下文对其有权访问的变量的有序访问。
如果在最顶级作用域还是找不到该变量，就抛出<strong>ReferenceError</strong></p> <h3 id="全局环境"><a href="#全局环境" aria-hidden="true" class="header-anchor">#</a> 全局环境</h3> <h4 id="无嵌套的函数"><a href="#无嵌套的函数" aria-hidden="true" class="header-anchor">#</a> 无嵌套的函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;inside myFunc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;outside&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当myFunc被定义的时候，myFunc的标识符（identifier）就被加到了全局对象中，这个标识符所引用的是一个函数对象（myFunc function object）。内部属性[[scope]]指向当前的作用域对象，也就是函数的标识符被创建的时候，我们所能够直接访问的那个作用域对象（即全局对象）。</p> <p>当当myFunc函数被调用的时候，一个新的作用域对象被创建了。新的作用域对象中包含myFunc函数所定义的本地变量，以及其参数（arguments）。这个新的作用域对象的父作用域对象就是在运行myFunc时能直接访问的那个作用域对象（即全局对象）。</p> <h4 id="有嵌套的函数"><a href="#有嵌套的函数" aria-hidden="true" class="header-anchor">#</a> 有嵌套的函数</h4> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>当函数返回没有被引用的时候，就会被垃圾回收器回收。但是对于闭包，即使外部函数返回了，函数对象仍会引用它被创建时的作用域对象。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token parameter">initial</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> counter <span class="token operator">=</span> initial<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counter <span class="token operator">+=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    increment<span class="token punctuation">:</span> increment<span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">get</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> myCounter <span class="token operator">=</span> <span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myCounter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 返回 100</span>

myCounter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myCounter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 返回 105</span>
</code></pre></div><p>当调用 createCounter(100) 时，内嵌函数increment和get都有指向createCounter(100) scope的引用。假设createCounter(100)没有任何返回值，那么createCounter(100) scope不再被引用，于是就可以被垃圾回收。</p> <p><img src="http://image.zhoufeifan.tech/blog/js/2/2-1.jpg" alt="image"></p> <p>但是createCounter(100)实际上是有返回值的，并且返回值被存储在了myCounter中，即使createCounter(100)已经返回，但是其作用域仍在，并且只能被内联函数访问。可以通过调用myCounter.increment() 或 myCounter.get()来直接访问createCounter(100)的作用域。
<img src="http://image.zhoufeifan.tech/blog/js/2/2-2.jpg" alt="image"></p> <p>调用get()时，当执行到return counter时，在get()所在的作用域并没有找到对应的标示符，就会沿着作用域链往上找，直到找到变量counter，然后返回该变量。</p> <p>单独调用increment(5)时，参数value保存在当前的作用域对象。当函数要访问counter时，没有找到，于是沿着作用域链向上查找，在createCounter(100)的作用域找到了对应的标示符，increment()就会修改counter的值。</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>当调用了两次 createCounter 会创建两个不同的作用域。</p></div> <p><img src="http://image.zhoufeifan.tech/blog/js/2/2-3.jpg" alt="image">
myCounter1.increment和myCounter2.increment的函数对象拥有着一样的代码以及一样的属性值（name，length等等），但是它们的[[scope]]指向的是不一样的作用域对象。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/js/1-2.html" class="prev">
          堆栈调用（下篇）
        </a></span> <span class="next"><a href="/doc/js/3.html">
          this绑定解析
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c9da9db2.js" defer></script><script src="/assets/js/2.febc0262.js" defer></script><script src="/assets/js/19.e58abf47.js" defer></script>
  </body>
</html>
