<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搜车库项目总结 | 周非凡个人博客</title>
    <meta name="description" content="Vue 驱动的静态网站生成器">
    
    
    <link rel="preload" href="/assets/css/0.styles.d01e3fed.css" as="style"><link rel="preload" href="/assets/js/app.c9da9db2.js" as="script"><link rel="preload" href="/assets/js/2.febc0262.js" as="script"><link rel="preload" href="/assets/js/32.e2e7fb69.js" as="script"><link rel="prefetch" href="/assets/js/10.0253064e.js"><link rel="prefetch" href="/assets/js/11.175002a3.js"><link rel="prefetch" href="/assets/js/12.c9c2623b.js"><link rel="prefetch" href="/assets/js/13.a252b052.js"><link rel="prefetch" href="/assets/js/14.6a53dc1e.js"><link rel="prefetch" href="/assets/js/15.84088994.js"><link rel="prefetch" href="/assets/js/16.09fbb166.js"><link rel="prefetch" href="/assets/js/17.38b70eaf.js"><link rel="prefetch" href="/assets/js/18.24a31878.js"><link rel="prefetch" href="/assets/js/19.e58abf47.js"><link rel="prefetch" href="/assets/js/20.a4e1f7ec.js"><link rel="prefetch" href="/assets/js/21.520b96e8.js"><link rel="prefetch" href="/assets/js/22.8455ead8.js"><link rel="prefetch" href="/assets/js/23.012b6e4c.js"><link rel="prefetch" href="/assets/js/24.90bca786.js"><link rel="prefetch" href="/assets/js/25.0b9867c9.js"><link rel="prefetch" href="/assets/js/26.5835b50d.js"><link rel="prefetch" href="/assets/js/27.90bf64b9.js"><link rel="prefetch" href="/assets/js/28.8b2856a2.js"><link rel="prefetch" href="/assets/js/29.4f0f0797.js"><link rel="prefetch" href="/assets/js/3.b8e8b8dc.js"><link rel="prefetch" href="/assets/js/30.ec214258.js"><link rel="prefetch" href="/assets/js/31.19d008c9.js"><link rel="prefetch" href="/assets/js/33.e7250e7c.js"><link rel="prefetch" href="/assets/js/34.6af80751.js"><link rel="prefetch" href="/assets/js/35.8c6fd912.js"><link rel="prefetch" href="/assets/js/36.abacb260.js"><link rel="prefetch" href="/assets/js/37.872fafd6.js"><link rel="prefetch" href="/assets/js/38.c11a6237.js"><link rel="prefetch" href="/assets/js/39.0251e2ab.js"><link rel="prefetch" href="/assets/js/4.a97bd63a.js"><link rel="prefetch" href="/assets/js/40.490030c9.js"><link rel="prefetch" href="/assets/js/41.ae009df1.js"><link rel="prefetch" href="/assets/js/42.733a49d6.js"><link rel="prefetch" href="/assets/js/43.6b0719ec.js"><link rel="prefetch" href="/assets/js/44.8abd3659.js"><link rel="prefetch" href="/assets/js/45.7e9da5d6.js"><link rel="prefetch" href="/assets/js/46.69831b02.js"><link rel="prefetch" href="/assets/js/47.0187e2c6.js"><link rel="prefetch" href="/assets/js/48.d573af72.js"><link rel="prefetch" href="/assets/js/49.c0de9630.js"><link rel="prefetch" href="/assets/js/5.9f3cace6.js"><link rel="prefetch" href="/assets/js/50.dd93629a.js"><link rel="prefetch" href="/assets/js/51.0de94388.js"><link rel="prefetch" href="/assets/js/52.f40156a5.js"><link rel="prefetch" href="/assets/js/53.cd0087a3.js"><link rel="prefetch" href="/assets/js/54.dc27779e.js"><link rel="prefetch" href="/assets/js/55.e83361b5.js"><link rel="prefetch" href="/assets/js/56.e98fbba1.js"><link rel="prefetch" href="/assets/js/57.29f5154b.js"><link rel="prefetch" href="/assets/js/58.2a266b80.js"><link rel="prefetch" href="/assets/js/59.a0a6d426.js"><link rel="prefetch" href="/assets/js/6.ea94c1bd.js"><link rel="prefetch" href="/assets/js/60.431c1ff3.js"><link rel="prefetch" href="/assets/js/61.f3c25606.js"><link rel="prefetch" href="/assets/js/62.df795bbf.js"><link rel="prefetch" href="/assets/js/7.954bbdf7.js"><link rel="prefetch" href="/assets/js/8.5ac09073.js"><link rel="prefetch" href="/assets/js/9.1c3b9112.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d01e3fed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/css/1.html" class="sidebar-link">css 常用知识点</a></li><li><a href="/doc/css/2.html" class="sidebar-link">清除浮动</a></li><li><a href="/doc/css/3.html" class="sidebar-link">三大经典问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/html/1.html" class="sidebar-link">浏览器解析流程</a></li><li><a href="/doc/html/2.html" class="sidebar-link">viewport原理</a></li><li><a href="/doc/html/3.html" class="sidebar-link">meta标签</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/js/1-1.html" class="sidebar-link">堆栈调用（上篇）</a></li><li><a href="/doc/js/1-2.html" class="sidebar-link">堆栈调用（下篇）</a></li><li><a href="/doc/js/2.html" class="sidebar-link">作用域与闭包</a></li><li><a href="/doc/js/3.html" class="sidebar-link">this绑定解析</a></li><li><a href="/doc/js/4-1.html" class="sidebar-link">call、apply原理与使用场景</a></li><li><a href="/doc/js/4-2.html" class="sidebar-link">bind 的原理与使用场景</a></li><li><a href="/doc/js/5-1.html" class="sidebar-link">浅拷贝概念以及实现原理</a></li><li><a href="/doc/js/5-2.html" class="sidebar-link">深拷贝概念以及实现原理</a></li><li><a href="/doc/js/6-1.html" class="sidebar-link">原型与继承之基本概念</a></li><li><a href="/doc/js/6-2.html" class="sidebar-link">原型与继承之（6种继承方案）</a></li><li><a href="/doc/js/7.html" class="sidebar-link">事件机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具函数 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/utils/1.html" class="sidebar-link">常见的JS方法</a></li><li><a href="/doc/utils/2.html" class="sidebar-link">常见的正则表达式</a></li><li><a href="/doc/utils/3.html" class="sidebar-link">常用的时间处理方法</a></li><li><a href="/doc/utils/4.html" class="sidebar-link">常用的金额处理方法</a></li><li><a href="/doc/utils/5.html" class="sidebar-link">继承和原型链demo</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/http/1.html" class="sidebar-link">常见的14种响应状态码</a></li><li><a href="/doc/http/2.html" class="sidebar-link">Http首部字段</a></li><li><a href="/doc/http/3.html" class="sidebar-link">Https介绍</a></li><li><a href="/doc/http/4.html" class="sidebar-link">Web的攻击技术</a></li><li><a href="/doc/http/5.html" class="sidebar-link">Http 发展历史</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/vue/1.html" class="sidebar-link">Vue 双向绑定的原理</a></li><li><a href="/doc/vue/2.html" class="sidebar-link">Vue 踩坑总结</a></li><li><a href="/doc/vue/3.html" class="sidebar-link">Vue 生命周期详解</a></li><li><a href="/doc/vue/4.html" class="sidebar-link">Vuex 基本用法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node 专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/node/1.html" class="sidebar-link">用node撸一个前端自动化发布工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>项目总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/project/1.html" class="sidebar-link">H5项目总结</a></li><li><a href="/doc/project/2.html" class="sidebar-link">首页优化项目总结</a></li><li><a href="/doc/project/3.html" class="sidebar-link">vue 输入限制</a></li><li><a href="/doc/project/4.html" class="active sidebar-link">搜车库项目总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="搜车库项目总结"><a href="#搜车库项目总结" aria-hidden="true" class="header-anchor">#</a> 搜车库项目总结</h1> <h3 id="ios-系统的坑"><a href="#ios-系统的坑" aria-hidden="true" class="header-anchor">#</a> IOS 系统的坑</h3> <h4 id="_1、输入框焦点问题"><a href="#_1、输入框焦点问题" aria-hidden="true" class="header-anchor">#</a> 1、输入框焦点问题</h4> <p>通常情况下当输入框聚焦时，点击输入框以外的任何元素，焦点都会离开，但是在 ipad 与 iphone上 这个效果不会触发。<br>
解决方案：给外层容器上绑定一个空的点击事件，当点击外层容器时，输入框自动失去焦点。</p> <h4 id="_2、键盘收起后页面不回落问题"><a href="#_2、键盘收起后页面不回落问题" aria-hidden="true" class="header-anchor">#</a> 2、键盘收起后页面不回落问题</h4> <p>出现场景：IOS12 上，微信版本 v6.7.4 及以上, 搜车库app中。现象如下图所示：</p> <p><img src="http://image.zhoufeifan.tech/blog/project/IMG_0014.PNG" alt="image">
经过探索发现，搜车库app的 viewport 中加了 &quot;viewport-fit=cover&quot; 属性，导致出现这种现象, 是系统脚手架默认带上这个属性。viewport-fit 的作用是什么呢?<br>
引用MDN上的描述：
<img src="http://image.zhoufeifan.tech/blog/project/11.png" alt="image">
viewport-fit: cover 的应用场景:
适配 iphoneX 的刘海屏
参考链接： https://aotu.io/notes/2017/11/27/iphonex/index.html</p> <p>解决微信上页面不回落的问题（最终解决方案），焦点离开收起键盘后，触发一次页面的滚动</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pullDown <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">inserted</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/(iPhone|iPad|iPod|iOS)/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>
                    <span class="token number">0</span><span class="token punctuation">,</span>
                    Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>
                        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span>
                        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight
                    <span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 从输入框切换到另一个输入框，则不需要触发滚动，需要清除定时器</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> pullDown<span class="token punctuation">;</span>
</code></pre></div><h3 id="图片手势缩放"><a href="#图片手势缩放" aria-hidden="true" class="header-anchor">#</a> 图片手势缩放</h3> <h4 id="整体思路："><a href="#整体思路：" aria-hidden="true" class="header-anchor">#</a> 整体思路：</h4> <ul><li>1、在touchstart事件中，双指按下的情况下记录两个触摸点的距离记为D1，在touchmove事件中，记录移动的两根手指触点的距离记为D2。</li> <li>2、根据D1与D2算出缩放比例，根据两个点的中心坐标与缩放区域左上角的坐标计算出缩放的坐标点。根据缩放比例和缩放坐标点就可以对一个元素进行缩放。</li> <li>3、如果没有二次缩放的需求，那么前两步已经算是完成了缩放的基本功能。二次缩放的功能是在原来缩放的基础上再次进行缩放，因此在计算缩放比例的时候时候要乘以上一次的缩放比例，初始的缩放比为1。<br>
举个例子: 第一次缩放，D2是D1的两倍，因此本次是对图片进行放大两倍的操作，那么图片最终的缩放比为上一次的缩放比（初始值1）* 本次的缩放比 1 * 2 = 2。第二次缩放， D2 是 D1 的 0.5 倍，因此本次是对图片缩小两倍的操作，那么图片最终的缩放比为上一次的缩放比（2）* 本次的缩放比 2 * 0.5 = 1，图片有缩小的原来的大小。</li></ul> <h4 id="补充说明"><a href="#补充说明" aria-hidden="true" class="header-anchor">#</a> 补充说明</h4> <ul><li><p>1、如何拿到缩放结束的回调，答案是无法拿到，有人以为用touchend事件来判断，但是 touchend 事件中无法根据e.touches.length（始终是0）属性去判断是否是两只手指同时离开，有可能只是单只手指的滑动。<br>
解决方案：debounce 的思想，设定一个时间阈值，当在这个时间值内滑动的事件不再触发，可以判断为结束滑动，执行结束回调。</p></li> <li><p>误触判断
因为不小心双指碰一下也会触发touchmove事件，因此还要进行误触判断。如果滑动的位置与开始按下的位置距离过小，则判定为误触不进行缩放。</p></li></ul> <h3 id="优雅地进行响应式的开发"><a href="#优雅地进行响应式的开发" aria-hidden="true" class="header-anchor">#</a> 优雅地进行响应式的开发</h3> <h4 id="单位选择-vw-or-rem-？"><a href="#单位选择-vw-or-rem-？" aria-hidden="true" class="header-anchor">#</a> 单位选择 vw or rem ？</h4> <p>我们选择了rem作为像素单位。因为本次开发的项目包含ipad与手机端，使用rem应对ipad端与手机端公共的样式只需要写一套代码，使用vw在无论什么情况下都需要写2套样式。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">// 2倍视觉稿上 500*300 的按钮
// 使用vw作为单位,视觉稿上手机宽度为 750，ipad宽度为 2048
.button.phone</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100 * 500 / 750vw<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100 * 300/ 750vw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.button.ipad</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100 * 500 / 2048vw<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100 * 300/ 2048vw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
// 使用rem作为像素单位，根据屏幕的宽度<span class="token punctuation">(</span>1024px作为分界点<span class="token punctuation">)</span>自动做适配，以20px作为基数，即视觉稿上的html根元素为20px<span class="token selector">;
// 对于公共的样式只需要些一套代码去适配
.button</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500 / 20rem<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300 / 20rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然上述的都是伪代码，less是不支持这种写法
因此最终的代码要这么写：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 25rem<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 15rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="手动计算不恶心吗？"><a href="#手动计算不恶心吗？" aria-hidden="true" class="header-anchor">#</a> 手动计算不恶心吗？</h4> <p>每次写样式都要在心里计算一遍单位，如果碰到不能被20整除的单位,只能使用计算器，非常恶心。<br>
好在 less 提供了一套单位转换函数 unit(@px, rem) 将px转化为rem，且它支持四则运算。<br>
因此上述的样式可以这么写：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">unit</span><span class="token punctuation">(</span>500/20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">unit</span><span class="token punctuation">(</span>300/20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="结束了？"><a href="#结束了？" aria-hidden="true" class="header-anchor">#</a> 结束了？</h4> <p>这样就结束了？远远不够，每次都要写重复的代码，非常麻烦，可以再节约些吗？<br>
使用less 提供的mixin 封装公共的样式方法:</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token mixin-usage function">.w</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token mixin-usage function">.h</span><span class="token punctuation">(</span>300<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// mixin</span>
<span class="token selector">.w(<span class="token variable">@px</span>)</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">unit</span><span class="token punctuation">(</span><span class="token variable">@px</span> <span class="token operator">/</span> <span class="token variable">@baseUnit</span><span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.h(<span class="token variable">@px</span>)</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">unit</span><span class="token punctuation">(</span><span class="token variable">@px</span> <span class="token operator">/</span> <span class="token variable">@baseUnit</span><span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="真的结束了吗？"><a href="#真的结束了吗？" aria-hidden="true" class="header-anchor">#</a> 真的结束了吗？</h4> <p>看似解决了重复的问题，但是有引入了新的问题：
设置margin的值，不能连着写, 必须写四个样式。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token mixin-usage function">.mt</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token mixin-usage function">.mr</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token mixin-usage function">.mb</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token mixin-usage function">.ml</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>遇到 translate, background-size 等这些不常用的样式，推荐用原始的方式去写。对这种不常用的样式封装意义不大，而且还会增加mixin函数的记忆成本。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token property">translate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token function">unit</span><span class="token punctuation">(</span>300<span class="token operator">/</span>20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">unit</span><span class="token punctuation">(</span>300<span class="token operator">/</span>20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token function">unit</span><span class="token punctuation">(</span>300<span class="token operator">/</span>20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">unit</span><span class="token punctuation">(</span>300<span class="token operator">/</span>20<span class="token punctuation">,</span> rem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="有最终的解决方案吗？"><a href="#有最终的解决方案吗？" aria-hidden="true" class="header-anchor">#</a> 有最终的解决方案吗？</h4> <p>感觉这样用起来还是很不方便，还远远达不到完美的境界，有更好的解决办法吗？不用记特定的语法那么麻烦。。。<br>
最终解决方案：采用 webpack 的 loader 直接完成单位的转换。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token property">translate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>300pxr<span class="token punctuation">,</span> 300pxr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> 300pxr<span class="token punctuation">,</span> 300pxr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// loader 转化后</span>
<span class="token selector">.button</span> <span class="token punctuation">{</span>
    <span class="token property">translate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>150rem<span class="token punctuation">,</span> 150rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> 150rem<span class="token punctuation">,</span> 150rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>思路：对.vue文件与.less 文件中的less代码做一次替换，把pxr单位转换成rem单位。在vue-loader与less-loader之前插入这个单位转化的 loader 完成单位的转化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// unit-convert-loader.js</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> remBase <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> isVueFile <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">replaceStyle</span><span class="token punctuation">(</span><span class="token parameter">styleStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> styleStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\d*\.?\d+pxr(?=;|\)|,| )/g</span><span class="token punctuation">,</span> <span class="token parameter">$<span class="token number">1</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> pixels <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pixels <span class="token operator">/</span> remBase<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// .vue 文件中从 style 标签中获取样式规则进行替换</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isVueFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
            <span class="token regex">/(&lt;style.+&gt;)([\s\S]*)(&lt;\/style&gt;)/g</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> style<span class="token punctuation">,</span> $<span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$<span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">replaceStyle</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$<span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 其他的样式文件，直接进行替换</span>
        <span class="token keyword">return</span> <span class="token function">replaceStyle</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>不用手动计算单位，不用记忆封装的函数，使用最接近原始的方式写css代码，是不是很方便。</p> <h4 id="vs-postcss-pxtorem"><a href="#vs-postcss-pxtorem" aria-hidden="true" class="header-anchor">#</a> VS postcss-pxtorem</h4> <p>与postcss-pxtorem 做比较，不敢说比它更优秀，但是应该比它更能满足我们目前的业务需求。一旦将来切换到其他项目，单位换成vw,这个工具只需稍微做个拓展，改变下loader中传入的参数也依旧可以支持。</p> <h4 id="结束了"><a href="#结束了" aria-hidden="true" class="header-anchor">#</a> 结束了</h4> <p>仅仅是文章结束了， 这种方法还有一些局限性，不支持vue模板中的style语法中的pxr。不是不能实现，一旦支持但是上面的“replaceStyle” 函数就没法复用，替换的正则表达式会更加复杂，而且即时支持了受益也不大，杀鸡不用牛刀，所以我选择放弃它。另外再补充一点，做移动端的项目，用scss做预处理器比较方便，因为scss自带了自定义函数的功能，如果你不想用这个单位转换的loader, scss 完全可以满足单位转换的需求。</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token keyword">@function</span> <span class="token function">pxToRem</span><span class="token punctuation">(</span><span class="token variable">$px</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">@return</span> <span class="token variable">$px</span> <span class="token operator">*</span> <span class="token variable">$baseUnit</span> <span class="token operator">*</span> 1rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.button</span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">pxToRem</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">pxToRem</span><span class="token punctuation">(</span>300<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span><span class="token function">pxToRem</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pxToRem</span><span class="token punctuation">(</span>300<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="tip custom-block"><p class="custom-block-title">附上vue-cli3 自定义loader的配置</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        config<span class="token punctuation">.</span>module
            <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.less$/</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'unit-convert-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'unit-convert-loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                remBase<span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span>module
            <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.vue$/</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'unit-convert-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'unit-convert-loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                remBase<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                isVueFile<span class="token punctuation">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/project/3.html" class="prev">
          vue 输入限制
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c9da9db2.js" defer></script><script src="/assets/js/2.febc0262.js" defer></script><script src="/assets/js/32.e2e7fb69.js" defer></script>
  </body>
</html>
